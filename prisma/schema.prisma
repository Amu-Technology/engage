// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id            String       @id @default(cuid())
  email         String       @unique
  name          String?
  image         String?
  role          String?      @default("user")
  org_id        Int?
  createdAt     DateTime     @default(now())
  updatedAt     DateTime     @updatedAt
  googleId      String?      @unique
  organization  Organization? @relation(fields: [org_id], references: [id])
}

model Organization {
  id        Int      @id @default(autoincrement())
  name      String
  users     User[]
  leads     Lead[]
  tasks     Task[]
  events    Event[]
  memos     Memo[]
  memoTypes MemoType[]
  groups    Group[]
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Group {
  id            String   @id @default(cuid())
  name          String
  organizationId Int
  organization  Organization @relation(fields: [organizationId], references: [id])
  leads         Lead[]
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
}

model Lead {
  id                    String   @id @default(cuid())
  organizationId        Int
  groupId              String?
  group                Group?    @relation(fields: [groupId], references: [id])
  type                 String   @default("individual")
  name                 String
  nameReading          String?
  nickname             String?
  district             String?
  homePhone            String?
  mobilePhone          String?
  company              String?
  position             String?
  postalCode           String?
  address              String?
  phone                String?
  email                String?
  referrer             String?
  evaluation           Int?     @default(0)
  status               String   @default("potential")
  profileImagePath     String?
  businessCardPath     String?
  isPaid               Boolean  @default(false)
  createdAt            DateTime @default(now())
  updatedAt            DateTime @updatedAt
  organization         Organization @relation(fields: [organizationId], references: [id])
  familyMembers        FamilyMember[]
  snsAccounts          SnsAccount?
  notificationPreferences NotificationPreference?
  tasks                Task[]
  events               Event[]
  memos                Memo[]
}

model FamilyMember {
  id          String   @id @default(cuid())
  leadId      String
  name        String
  nameReading String?
  relationship String?
  lead        Lead     @relation(fields: [leadId], references: [id])
}

model SnsAccount {
  id          String   @id @default(cuid())
  leadId      String   @unique
  lineUserId  String?
  facebookUserId String?
  facebookPageId String?
  twitterHandle String?
  instagramUsername String?
  lead        Lead     @relation(fields: [leadId], references: [id])
}

model NotificationPreference {
  id          String   @id @default(cuid())
  leadId      String   @unique
  email       Boolean  @default(false)
  line        Boolean  @default(false)
  facebook    Boolean  @default(false)
  instagram   Boolean  @default(false)
  lead        Lead     @relation(fields: [leadId], references: [id])
}

model Task {
  id            String   @id @default(cuid())
  organizationId Int
  type          String
  assignee      String
  dueDate       DateTime
  status        String   @default("pending")
  relatedLeadId String?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  organization  Organization @relation(fields: [organizationId], references: [id])
  lead          Lead?    @relation(fields: [relatedLeadId], references: [id])
}

model Event {
  id            String   @id @default(cuid())
  organizationId Int
  title         String
  startDate     DateTime
  endDate       DateTime
  location      String?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  organization  Organization @relation(fields: [organizationId], references: [id])
  leads         Lead[]
}

model Memo {
  id            String   @id @default(cuid())
  leadId        String
  organizationId Int
  type          String
  timestamp     DateTime
  note          String
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  lead          Lead     @relation(fields: [leadId], references: [id])
  organization  Organization @relation(fields: [organizationId], references: [id])
  memoType      MemoType?   @relation(fields: [type], references: [id])
}

model MemoType {
  id            String   @id @default(cuid())
  name          String
  color         String?
  organizationId Int
  organization  Organization @relation(fields: [organizationId], references: [id])
  memos         Memo[]
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
}
